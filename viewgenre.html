<!DOCTYPE html>
<html lang="en">
<head>
<title>Genre list</title>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="css/bootstrap.min.css" />
<link rel="stylesheet" href="css/bootstrap-responsive.min.css" />
<link rel="stylesheet" href="css/uniform.css" />
<link rel="stylesheet" href="css/select2.css" />
<link rel="stylesheet" href="css/matrix-style.css" />
<link rel="stylesheet" href="css/matrix-media.css" />
<link href="font-awesome/css/font-awesome.css" rel="stylesheet" />
<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700,800' rel='stylesheet' type='text/css'>
</head>
<body>

<!--Header-part-->
<div id="header">
  <h1><a href="dashboard.html">Trang quản trị</a></h1>
</div>
<!--close-Header-part--> 

<!--top-Header-menu-->
<div id="user-nav" class="navbar navbar-inverse">
  <ul class="nav">
    <li  class="dropdown" id="profile-messages" ><a title="" href="#" data-toggle="dropdown" data-target="#profile-messages" class="dropdown-toggle"><i class="icon icon-user"></i>  <span class="text">Xin chào</span><b class="caret"></b></a>
      <ul class="dropdown-menu">
        <li><a href="#"><i class="icon-user"></i> Thông tin</a></li>
        <li class="divider"></li>
        <!--<li><a href="#"><i class="icon-check"></i> My Tasks</a></li>
        <li class="divider"></li>-->
        <li><a href="#" onclick="logout()"><i class="icon-key"></i> Thoát</a></li>
      </ul>
    </li>
    <li class="dropdown" id="menu-messages"><a href="#" data-toggle="dropdown" data-target="#menu-messages" class="dropdown-toggle"><i class="icon icon-envelope"></i> <span class="text">Tin nhắn</span> <span class="label label-important">5</span> <b class="caret"></b></a>
      <ul class="dropdown-menu">
        <li><a class="sAdd" title="" href="#"><i class="icon-plus"></i> Tin nhắn mới</a></li>
        <li class="divider"></li>
        <li><a class="sInbox" title="" href="#"><i class="icon-envelope"></i> Thư đến</a></li>
        <li class="divider"></li>
        <!--<li><a class="sOutbox" title="" href="#"><i class="icon-arrow-up"></i> outbox</a></li>
        <li class="divider"></li>-->
        <li><a class="sTrash" title="" href="#"><i class="icon-trash"></i> Đã xóa</a></li>
      </ul>
    </li>
    <li class=""><a title="" href="#"><i class="icon icon-cog"></i> <span class="text">Cài đặt</span></a></li>
    <li class=""><a title="" href="#"><i class="icon icon-share-alt"></i> <span class="text">Thoát</span></a></li>
  </ul>
</div>
<!--close-top-Header-menu-->
<!--start-top-serch-->
<div id="search">
  <input type="text" placeholder="Tìm kiếm..."/>
  <button type="submit" class="tip-bottom" title="Search"><i class="icon-search icon-white"></i></button>
</div>
<!--close-top-serch--> 

<!--sidebar-menu-->

<div id="sidebar"><a href="#" class="visible-phone"><i class="icon icon-home"></i> Trang quản trị</a>
  <ul>
    <li ><a href="index.html"><i class="icon icon-home"></i> <span>Trang quản trị</span></a> </li>
    <li class="submenu"> <a href="#"><i class="icon icon-signal"></i> <span>Song</span> </a>
      <ul>
        <li><a href="newsong.html">Add new song</a></li>
        <li><a href="viewsong.html">Song list </a></li>
        
        
      </ul>
    </li>
    
    <li class="submenu"> <a href="#"><i class="icon icon-signal"></i> <span>Artist</span> </a>
      <ul>
        <li><a href="newartist.html">Add new artist</a></li>
        <li><a href="viewartist.html">Artist list</a></li>
        
        
      </ul>
    </li>
    <li class="submenu active"> <a href="#"><i class="icon icon-signal"></i> <span>Genre</span> </a>
      <ul>
        <li><a href="newgenre.html">Add new genre</a></li>
        <li class="active"><a href="viewgenre.html">Genre list</a></li>
        
        
      </ul>
    </li>
    <li class="submenu"> <a href="#"><i class="icon icon-signal"></i> <span>Album</span> </a>
      <ul>
        <li><a href="newalbum.html">Add new album</a></li>
        <li><a href="viewalbum.html">Album list</a></li>
        
        
      </ul>
    </li>
    
  </ul>
</div>
<div id="content">
  <div id="content-header">
    <div id="breadcrumb"> <a href="index.html" title="Go to Home" class="tip-bottom"><i class="icon-home"></i> Trang chủ</a> <a href="#" class="current">Genre list</a> </div>
    <h1>Genre list</h1>
  </div>
  <div class="container-fluid">
    <hr>
    <div class="row-fluid">
      <div class="span12">
        
        
        
        <div class="widget-box">
          <div class="widget-title"></div>
          <div id = "genData" class="widget-content nopadding">
            
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!--Footer-part-->
<div class="row-fluid">
  <div id="footer" class="span12"> 2016 &copy;</a> </div>
</div>
<!--end-Footer-part-->
<script src="js/jquery.min.js"></script> 
<script src="js/jquery.ui.custom.js"></script> 
<script src="js/bootstrap.min.js"></script> 
<script src="js/jquery.uniform.js"></script> 
<script src="js/select2.min.js"></script> 
<script src="js/jquery.dataTables.min.js"></script> 
<script src="js/matrix.js"></script> 
<script src="js/matrix.tables.js"></script>
<script src="js/myjs.js"></script>
<script type="text/javascript">
if(localStorage.getItem("token") == null){
    window.location = 'login.html';
  }
var albumName = "";
var arr;
  if (window.XMLHttpRequest)
                  {
                      // code for IE7+, Firefox, Chrome, Opera, Safari
                      xmlhttp=new XMLHttpRequest();
                  } else {
                      // code for IE6, IE5
                      xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
                  }

          xmlhttp.onreadystatechange=function() {
          if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
              myFunction(xmlhttp.responseText);
          }
      }
      xmlhttp.open("GET", 'https://musicstore-app.herokuapp.com/api/v1/genre', true);
      xmlhttp.send();

function myFunction(response) {
  arr = JSON.parse(response);
  console.log(arr);
  render(arr);
    }
    function render(arr){
      var i;
  var out = '<table class="table table-bordered data-table table-striped with-check">' +
             '<thead>' +
                '<tr>' + 
                  '<th style="width: 100px">Display Name</th>' +
                  '<th style="width: 400px">Description</th>' +
                  '<th style="width: 150px">Update/Delete</th>' +
                '</tr>' +
              '</thead>' +
              '<tbody>';                
  for(i = 0; i < arr.length; i++)
    {
               // var album = getAlbumById(arr[i].AlbumId);
                 //console.log(albumName); 
                 out += "<tr><td>" +
                 arr[i].DisplayName +
                 "</td><td class='center'>" +
                 arr[i].Description +
                 "</td>" + '<td class="center" style="width: 50px"> <button class="btn btn-success"><a href="editgenre.html?' +
                 'genre=' + arr[i]._id +                 
                 '">Update</a> </button> <button class= "btn btn-warning" onclick="Delete(' + "'" + arr[i]._id + "'" +')"><a href="#">Delete</a></button></td></tr>';
              }
        out += "</tbody></table>";
        document.getElementById("genData").innerHTML = out;
    }

    function Delete(id){
       if (window.XMLHttpRequest)
                  {
                      // code for IE7+, Firefox, Chrome, Opera, Safari
                      xmlhttp=new XMLHttpRequest();
                  } else {
                      // code for IE6, IE5
                      xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
                  }

          xmlhttp.onreadystatechange=function() {
          if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
              alert('success');
              render(arr.filter(function(e) { return e._id !== id; }));
          }
          else if (xmlhttp.readyState == 4 && xmlhttp.status != 200)
          {
            alert(xmlhttp.responseText);
          }
      }
      xmlhttp.open("Delete", 'https://musicstore-app.herokuapp.com/api/v1/genre', true);
      xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
      xmlhttp.setRequestHeader("Authorization", "Bearer " + localStorage.getItem("token"));
      xmlhttp.send("genre_id=" + id );
    }
</script>
</body>
</html>
